# SuperChat V4 Specification

## Overview

V4 focuses on quality-of-life features that fit the retro terminal aesthetic while bringing in the best of modern chat without the stress-inducing parts. No typing indicators, no read receipts, no anxiety - just useful features.

**V4 Status:** Planning

**Design Philosophy:**
- Retro terminal aesthetic (IRC/BBS inspired)
- Bring in what's positive from modern era
- Avoid stress-inducing features (typing indicators, read receipts, seen timestamps)
- Keep it simple and text-focused

---

## V4 Feature List

### 1. Plus-One Reactions (+1)
**Status:** Not Started
**Priority:** High
**Complexity:** Low

Reduce thread noise from "me too" style comments with a simple +1 feature.

**Design:**
- Two counters per message:
  - **Registered count**: One +1 per user per message, tracked, meaningful
  - **Anonymous count (+∞)**: Unlimited, chaotic, entertainment value
- Count only goes up, never down (no downvotes, no negativity)
- No per-user tracking visible to others (no "who liked this" anxiety)

**Display:**
```
+42 (+∞ 1337)
```

**Protocol Messages:**
- `PLUS_ONE (0x??)` - Client → Server: message_id
- `PLUS_ONE_UPDATE (0x??)` - Server → Client: message_id, registered_count, anonymous_count

**Database Changes:**
- Add `plus_one_count` INTEGER to Message table (registered users)
- Add `plus_one_anon_count` INTEGER to Message table (anonymous users)
- Add `UserPlusOne` table: user_id, message_id (track who +1'd to prevent duplicates)

**Notes:**
- Naturally incentivizes registration without being preachy
- Anonymous counter adds character/fun element

---

### 2. Client Local Storage
**Status:** Not Started
**Priority:** High
**Complexity:** Medium

Cache messages locally so they persist beyond server retention. Foundation for search and offline access.

**Features:**
- Local SQLite database on client
- Store all messages you've seen
- Persist across sessions
- No expiration (or user-configurable)

**Sync Model (RSS-style feed):**
- `SYNC_FEED` request: "give me everything since timestamp X"
- Server returns all accessible messages since that time
- Client appends to local DB, updates last-sync timestamp
- Sync on connect, periodically, or manually (`/sync`)

**Protocol Messages:**
- `SYNC_REQUEST (0x??)` - Client → Server: since_timestamp, optional channel filter
- `SYNC_RESPONSE (0x??)` - Server → Client: array of messages, next_timestamp

**Benefits:**
- Messages survive server retention expiry
- Enables offline reading
- Foundation for local search
- Simple append-only model, no conflict resolution

---

### 3. Message Search
**Status:** Not Started
**Priority:** Medium
**Complexity:** Low (once local storage exists)
**Depends on:** Client Local Storage

Search your locally cached messages. Very terminal-native (`/search` or grep-like).

**Features:**
- Search within current channel
- Search across all cached messages
- Search own messages only
- Regex support (fits the terminal aesthetic)

**Implementation:**
- Entirely client-side, queries local SQLite
- No server involvement
- SQLite FTS (full-text search) for performance

**UI:**
- `/search <query>` command
- `/search -c #channel <query>` to limit to channel
- Results shown in scrollable view
- Jump to message from results

---

### 4. User Mentions (@username)
**Status:** Not Started
**Priority:** High
**Complexity:** Low

Simple text-based mentions, fits IRC style.

**Features:**
- `@username` in message triggers notification
- Highlight messages that mention you
- Optional: `/mentions` to see all messages mentioning you

**Notes:**
- Keep it simple - just pattern matching on @username
- No fancy autocomplete needed (but could add later)

---

### 5. Message Pinning
**Status:** Not Started
**Priority:** Medium
**Complexity:** Low

Pin important messages in a channel/thread.

**Features:**
- `/pin` command (channel owner/admin only?)
- Pinned messages shown at top of channel or via `/pins`
- Limit on number of pins per channel

**Database Changes:**
- Add `pinned_at` TIMESTAMP to Message table (NULL = not pinned)
- Or separate `PinnedMessage` table for more flexibility

---

### 6. Channel Topic
**Status:** Not Started
**Priority:** Medium
**Complexity:** Low

Classic IRC-style channel topics.

**Features:**
- Topic displayed on channel join
- `/topic` to view current topic
- `/topic <new topic>` to set (channel owner/admin)
- Topic change broadcast to channel members

**Database Changes:**
- Add `topic` TEXT to Channel table

---

### 7. Server MOTD (Message of the Day)
**Status:** Not Started
**Priority:** Medium
**Complexity:** Low

Message displayed on connect, very retro.

**Features:**
- Displayed in channel list welcome pane (before any channel selected)
- Configurable by admins through TUI admin panel
- `/motd` command to view again
- Supports multi-line text

**Implementation:**
- Add `motd` TEXT column to server config in database (or separate table)
- Include MOTD in SERVER_CONFIG message (new optional field)
- Admin panel: new "Set MOTD" option
- Protocol: `SET_MOTD` (admin → server), update SERVER_CONFIG to include MOTD

**UI Location:**
- Channel list view, right pane (where welcome message currently shows)
- Replaces or augments the current welcome text

---

### 8. User Ignore
**Status:** Not Started
**Priority:** Medium
**Complexity:** Low

Classic IRC feature: `/ignore username`

**Features:**
- Messages from ignored users not displayed in channels
- DM requests from ignored users auto-rejected silently (never shown)
- `/ignore <username>` to add
- `/ignore` or `/ignore list` to see ignored users
- `/unignore <username>` to remove
- Persisted in client config

**Implementation:**
- Entirely client-side, completely private
- Filter messages in UI before display
- Hook into DM request handler to auto-reject
- Store ignore list in local client database/config

**Notes:**
- No server changes needed
- No one knows who you're ignoring (privacy)

---

### 9. Away Messages
**Status:** Not Started
**Priority:** Low
**Complexity:** Low

Another IRC staple: `/away <reason>`

**Features:**
- `/away Working on stuff` - set away with reason
- `/away` or `/back` - clear away status
- Away status shown when someone tries to DM you
- Optional: show away indicator in user lists

**Database/Protocol:**
- Add away status to session
- Broadcast away status changes?

---

### 10. Nickname History (/whowas)
**Status:** Not Started
**Priority:** Low
**Complexity:** Low

Who was this person before?

**Features:**
- `/whowas username` - show previous nicknames
- Only for registered users (anonymous = no history)
- Privacy consideration: how far back? Opt-out?

**Database Changes:**
- `NicknameHistory` table: user_id, old_nickname, changed_at

---

### 11. Connection Stats
**Status:** Not Started
**Priority:** Low
**Complexity:** Low

Nerdy terminal stats for power users.

**Features:**
- `/stats` command showing:
  - Connection uptime
  - Bytes sent/received
  - Messages sent/received
  - Current latency (ping time)
  - Server uptime
  - Online user count

**Implementation:**
- Mostly client-side tracking
- Some stats from server (uptime, user count already in SERVER_STATS)

---

### 12. Channel Permissions / Modes
**Status:** Not Started
**Priority:** Medium
**Complexity:** Medium

IRC-style channel modes.

**Features:**
- Invite-only channels (`/mode +i`)
- Moderated channels (only ops can post)
- Channel operators/moderators
- `/kick` and `/ban` for moderation

**Notes:**
- Could be complex - maybe defer to V5
- Start simple: just invite-only?

---

## Features Explicitly NOT Adding

These don't fit the retro/stress-free philosophy:

- **Typing indicators** - Creates pressure to respond immediately
- **Read receipts** - Same anxiety-inducing effect
- **Seen timestamps** - "Why haven't they responded?"
- **Emoji reactions beyond +1** - Too Slack/Discord, clutters the terminal aesthetic
- **Voice/video** - Out of scope, different product entirely
- **Stories/status updates** - Social media creep, not a chat feature

---

## Implementation Priority (Suggested)

**Phase 1 - High Value, Low Effort:**
1. Plus-One Reactions (+1/+∞)
2. User Mentions (@username)
3. Channel Topic

**Phase 2 - Quality of Life:**
4. Message Search
5. Message Pinning
6. Server MOTD

**Phase 3 - Power User Features:**
7. User Ignore/Block
8. Away Messages
9. Connection Stats
10. Nickname History

**Phase 4 - Advanced (maybe V5):**
11. Channel Permissions/Modes

---

## Database Migrations (Planned)

- `012_add_plus_one.sql` - Plus-one counts and tracking table
- `013_add_channel_topic.sql` - Topic field on Channel
- `014_add_nickname_history.sql` - Nickname history tracking
- `015_add_pinned_messages.sql` - Message pinning

---

## References

- **V1 Spec:** See `docs/versions/V1.md`
- **V2 Spec:** See `docs/versions/V2.md`
- **V3 Spec:** See `docs/versions/V3.md`
- **Protocol:** See `docs/PROTOCOL.md`

---

**Note:** V4 is in planning phase. Features and priorities subject to change based on feedback.
